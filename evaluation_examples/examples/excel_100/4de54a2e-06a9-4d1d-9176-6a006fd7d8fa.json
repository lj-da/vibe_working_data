{
  "id": "4de54a2e-06a9-4d1d-9176-6a006fd7d8fa",
  "snapshot": "libreoffice_calc",
  "instruction": "快速提取年度，B列单元格筛选结果如上图，其格式五花八门，有文本、日期等，如何B列对应日期的年度（只要年度）提取到对应的R列？",
  "method": "使用IFERROR函数结合YEAR、TEXT和SUBSTITUTE函数来从B列提取年度到R列。在R4单元格中输入公式=IFERROR(YEAR(TEXT(SUBSTITUTE(B4,\".\",\"-\"),\"yyyy-mm-dd\")),LEFT(B4,4))。该公式的工作原理：第一步SUBSTITUTE(B4,\".\",\"-\")将B4单元格中的日期格式从\"2024. 12. 25\"转换为\"2024-12-25\"，将点号替换为连字符。第二步TEXT(...,\"yyyy-mm-dd\")将替换后的字符串转换为Excel可识别的日期格式。第三步YEAR(...)从日期中提取年份。第四步IFERROR(...,LEFT(B4,4))如果前面的转换或提取过程出现错误（例如B列是文本格式无法转换），则使用LEFT(B4,4)提取B4单元格的前4个字符作为年度。这样无论B列是日期格式还是文本格式，都能正确提取年度。然后将公式向下复制到R列的其他行（如R5、R6等），相对引用会自动调整，B4会变成B5、B6等。",
  "source": "original",
  "config": [
    {
      "type": "execute",
      "parameters": {
        "command": [
          "bash",
          "-c",
          "cat > /home/user/Desktop/formula.txt << 'EOF'\nR4=IFERROR(YEAR(TEXT(SUBSTITUTE(B4,\".\",\"-\"),\"yyyy-mm-dd\")),LEFT(B4,4))\nEOF"
        ]
      }
    },
    {
      "type": "download",
      "parameters": {
        "files": [
          {
            "url": "https://huggingface.co/datasets/LJ-HX/vibe_working_data/resolve/main/vibe_data_100/282.xlsx",
            "path": "/home/user/iferror_year_text_substitute.xlsx"
          }
        ]
      }
    },
    {
      "type": "open",
      "parameters": {
        "path": "/home/user/iferror_year_text_substitute.xlsx"
      }
    }
  ],
  "trajectory": "trajectories/4de54a2e-06a9-4d1d-9176-6a006fd7d8fa",
  "related_apps": [
    "libreoffice_calc"
  ],
  "evaluator": {
    "postconfig": [
      {
        "type": "activate_window",
        "parameters": {
          "window_name": "iferror_year_text_substitute.xlsx - LibreOffice Calc",
          "strict": false
        }
      },
      {
        "type": "sleep",
        "parameters": {
          "seconds": 0.5
        }
      },
      {
        "type": "execute",
        "parameters": {
          "command": [
            "python",
            "-c",
            "import pyautogui; pyautogui.hotkey('ctrl', 's');"
          ]
        }
      },
      {
        "type": "sleep",
        "parameters": {
          "seconds": 0.5
        }
      }
    ],
    "func": "verify_iferror_year_text_substitute",
    "result": {
      "type": "vm_file",
      "path": "/home/user/iferror_year_text_substitute.xlsx",
      "dest": "iferror_year_text_substitute.xlsx"
    },
    "options": {
      "formula_column": "R",
      "source_column": "B",
      "start_row": 4,
      "expected_functions": [
        "IFERROR",
        "YEAR",
        "TEXT",
        "SUBSTITUTE",
        "LEFT"
      ]
    },
    "expected": {
      "type": "cloud_file",
      "path": "https://huggingface.co/datasets/LJ-HX/vibe_working_data/resolve/main/cache/4de54a2e-06a9-4d1d-9176-6a006fd7d8fa/iferror_year_text_substitute.xlsx",
      "dest": "iferror_year_text_substitute.xlsx"
    }
  },
  "proxy": false,
  "fixed_ip": false,
  "possibility_of_env_change": "low"
}