{
  "id": "67f271b9-d851-4fcc-94c8-6038d9ebed85",
  "snapshot": "libreoffice_calc",
  "instruction": "当我选择右侧的下拉框\"产品1\"或\"产品2\"或\"产品3\"时，J列会显示该产品对应的H列的国家内数量由多到少的前五位的Code，K列会显示该Code 对应的数量。如果H列的国家内没有该产品的内容，那么就显示为空。",
  "method": "使用INDEX、LARGE、OFFSET、MATCH、COUNTIF等函数组合实现多条件查找和排序。第一步：在J3单元格中输入数组公式=INDEX(B:B,RIGHT(LARGE(((A$4:A$23=N$4)*(OFFSET($B$4,,MATCH(H3,$C$3:$F$3,),20)<>0))*(OFFSET($B$4,,MATCH(H3,$C$3:$F$3,),20)*100+ROW($4:$23)),COUNTIF(H$3:H3,H3)),2))&\"\"。ctrl+shift+enter下拉，该公式的工作原理：1)MATCH(H3,$C$3:$F$3,)查找H3单元格中的国家在C3:F3中的位置；2)OFFSET($B$4,,MATCH(...),20)获取该国家列的数据范围；3)(A$4:A$23=N$4)检查A列是否等于N4（选中的产品）；4)(OFFSET(...)<>0)检查数量是否不为0；5)将满足条件的数量乘以100加上行号，使用LARGE函数获取第N大的值；6)COUNTIF(H$3:H3,H3)计算当前国家出现的次数，用于获取第1、2、3、4、5大的值；7)RIGHT(...,2)提取行号；8)INDEX(B:B,...)根据行号获取Code；9)&\"\"处理空值。输入后按Ctrl+Shift+Enter确认数组公式，然后向下复制到J23。第二步：在K3单元格中输入公式=IF(J3=\"\",\"\",VLOOKUP(J3,B:F,MATCH(H3,B$3:F$3,),))。该公式的工作原理：1)IF(J3=\"\",\"\",...)如果J3为空则返回空，否则执行VLOOKUP；2)VLOOKUP(J3,B:F,MATCH(H3,B$3:F$3,),)在B:F范围内查找J3的值，返回MATCH(H3,B$3:F$3,)列（对应国家的数量列）的值。然后将公式向下复制到K23。",
  "source": "original",
  "config": [
    {
      "type": "execute",
      "parameters": {
        "command": [
          "bash",
          "-c",
          "cat > /home/user/Desktop/formula.txt << 'EOF'\nJ3=INDEX(B:B,RIGHT(LARGE(((A$4:A$23=N$4)*(OFFSET($B$4,,MATCH(H3,$C$3:$F$3,),20)<>0))*(OFFSET($B$4,,MATCH(H3,$C$3:$F$3,),20)*100+ROW($4:$23)),COUNTIF(H$3:H3,H3)),2))&\"\"\nK3=IF(J3=\"\",\"\",VLOOKUP(J3,B:F,MATCH(H3,B$3:F$3,),))\nEOF"
        ]
      }
    },
    {
      "type": "download",
      "parameters": {
        "files": [
          {
            "url": "https://huggingface.co/datasets/LJ-HX/vibe_working_data/resolve/main/vibe_data_100/283.xlsx",
            "path": "/home/user/index_large_offset_match_top5.xlsx"
          }
        ]
      }
    },
    {
      "type": "open",
      "parameters": {
        "path": "/home/user/index_large_offset_match_top5.xlsx"
      }
    }
  ],
  "trajectory": "trajectories/67f271b9-d851-4fcc-94c8-6038d9ebed85",
  "related_apps": [
    "libreoffice_calc"
  ],
  "evaluator": {
    "postconfig": [
      {
        "type": "activate_window",
        "parameters": {
          "window_name": "index_large_offset_match_top5.xlsx - LibreOffice Calc",
          "strict": false
        }
      },
      {
        "type": "sleep",
        "parameters": {
          "seconds": 0.5
        }
      },
      {
        "type": "execute",
        "parameters": {
          "command": [
            "python",
            "-c",
            "import pyautogui; pyautogui.hotkey('ctrl', 's');"
          ]
        }
      },
      {
        "type": "sleep",
        "parameters": {
          "seconds": 0.5
        }
      }
    ],
    "func": "verify_index_large_offset_match_top5",
    "result": {
      "type": "vm_file",
      "path": "/home/user/index_large_offset_match_top5.xlsx",
      "dest": "index_large_offset_match_top5.xlsx"
    },
    "options": {
      "j_column": "J",
      "k_column": "K",
      "start_row": 3,
      "end_row": 23,
      "j_expected_functions": ["INDEX", "LARGE", "OFFSET", "MATCH", "COUNTIF", "RIGHT", "ROW"],
      "k_expected_functions": ["IF", "VLOOKUP", "MATCH"],
      "product_range": "A$4:A$23",
      "product_cell": "N$4",
      "country_header_range": "$C$3:$F$3",
      "code_column": "B",
      "data_range": "B:F"
    }
  },
  "proxy": false,
  "fixed_ip": false,
  "possibility_of_env_change": "low"
}

